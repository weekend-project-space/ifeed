# AI 优先 RSS 阅读器：接口文档 (API 文档)

本接口文档描述了前端与后端交互所使用的 RESTful API。

> **分页说明**
> 所有带有 `page` / `size` 查询参数的接口均返回 Spring Data `Page` 风格的响应，示例结构如下（页码从 0 开始）：
>
> ```json
> {
>   "content": [ ... ],
>   "pageable": {
>     "pageNumber": 0,
>     "pageSize": 10,
>     "sort": {
>       "sorted": false,
>       "unsorted": true,
>       "empty": true
>     }
>   },
>   "totalElements": 42,
>   "totalPages": 5,
>   "last": false,
>   "first": true,
>   "size": 10,
>   "number": 0,
>   "sort": {
>     "sorted": false,
>     "unsorted": true,
>     "empty": true
>   },
>   "numberOfElements": 10,
>   "empty": false
> }
> ```

## 1. 用户认证

### 注册

- 方法：`POST /api/auth/register`
- 认证：无需认证
- 请求体：

```json
{
  "username": "string",
  "password": "string"
}
```

- 响应体：

```json
{
  "token": "string",
  "userId": "string"
}
```

### 登录

- 方法：`POST /api/auth/login`
- 认证：无需认证
- 请求体：

```json
{
  "username": "string",
  "password": "string"
}
```

- 响应体：

```json
{
  "token": "string",
  "userId": "string"
}
```

### 获取用户信息

- 方法：`GET /api/user`
- 认证：`Bearer <token>`
- 响应体：

```json
{
  "userId": "string",
  "username": "string"
}
```

## 2. 订阅管理

### 添加订阅

- 方法：`POST /api/subscriptions`
- 认证：`Bearer <token>`
- 请求体：

```json
{
  "feedUrl": "string"
}
```

- 响应体：

```json
{
  "message": "Subscription added."
}
```

### 获取订阅列表

- 方法：`GET /api/subscriptions`
- 认证：`Bearer <token>`
- 响应体：

```json
[
  {
    "feedId": "string",
    "title": "string",
    "url": "string",
    "siteUrl": "string",
    "lastFetched": "2024-03-01T08:00:00Z",
    "lastUpdated": "2024-03-01T09:45:00Z",
    "isRead": true
  }
]
```

- `lastFetched`：后端最近一次抓取该源的时间。
- `siteUrl`：订阅源对应的网站主页，当缺失时回退至 `url`。
- `lastUpdated`：RSS 源内容检测到的最近更新时间，用于前端提示源的活跃度。
- `isRead`：当前用户已读。

### 取消订阅

- 方法：`DELETE /api/subscriptions/:feedId`
- 认证：`Bearer <token>`
- 响应体：

```json
{
  "message": "Subscription removed."
}
```

## 3. 文章内容

### 获取文章列表

- 方法：`GET /api/articles`
- 认证：`Bearer <token>`
- 查询参数：
    - `page`（默认 0）
    - `size`（默认 10）
    - `sort`（可选，如 `publishedAt,desc`）
    - `feedId`（可选，用于筛选单个订阅源）
    - `tags`（可选，按标签过滤，多个用逗号分隔）
    - `category`（可选，按文章分类过滤，大小写不敏感）
    - `source`（可选，默认 `owner`。`owner`：只返回当前用户的数据；`global`：返回全局数据，不区分用户）
- 响应体：

```json
{
  "content": [
    {
      "id": "string",
      "title": "string",
      "link": "string",
      "summary": "string",
      "thumbnail": "https://example.com/cover.jpg",
      "enclosure": "https://example.com/audio.mp3",
      "feedTitle": "string",
      "publishedAt": "2024-03-01T10:00:00Z",
      "tags": [
        "AI",
        "推荐"
      ],
      "timeAgo": "2 小时前"
    }
  ],
  "pageable": {
    "pageNumber": 0,
    "pageSize": 10,
    "sort": {
      "sorted": true,
      "unsorted": false,
      "empty": false
    }
  },
  "totalElements": 42,
  "totalPages": 5,
  "last": false,
  "first": true,
  "size": 10,
  "number": 0,
  "sort": {
    "sorted": true,
    "unsorted": false,
    "empty": false
  },
  "numberOfElements": 10,
  "empty": false
}
```

- `thumbnail`：用于展示文章缩略图，通常来自 RSS 中的图片资源，可能为空。
- `enclosure`：原始多媒体资源链接（音频、视频等），可用于播放器或下载。
- `tags` 查询支持逗号分隔的多个标签，忽略大小写。
- `category` 查询按文章 `category` 字段精确匹配（忽略大小写）。

### 获取文章详情

- 方法：`GET /api/articles/:articleId`
- 认证：`Bearer <token>`
- 响应体：

```json
{
  "id": "string",
  "title": "string",
  "content": "string",
  "summary": "string",
  "thumbnail": "https://example.com/cover.jpg",
  "enclosure": "https://example.com/audio.mp3",
  "feedTitle": "string",
  "publishedAt": "2024-03-01T10:00:00Z",
  "tags": [
    "AI",
    "推荐"
  ]
}
```

### 获取订阅内容概览（分类与热门标签）

- 方法：`GET /api/articles/insights`
- 认证：`Bearer <token>`
- 查询参数：
    - `from`（可选，ISO-8601 时间，默认 `now-14d`）
    - `to`（可选，ISO-8601 时间，默认 `now`）
    - `top`（可选，热门标签返回个数，默认 20）
- 说明：统计当前用户可见范围内（其激活的订阅源）的文章，在给定时间窗口内的分类计数和热门标签。
- 响应体：

```json
{
  "categories": [
    {
      "category": "Tech",
      "count": 12
    },
    {
      "category": "AI",
      "count": 8
    }
  ],
  "hotTags": [
    {
      "tag": "llm",
      "count": 10
    },
    {
      "tag": "java",
      "count": 7
    }
  ]
}
```

## 4. 订阅源频道

### 获取订阅源详情

- 方法：`GET /api/feeds/:feedId`
- 认证：`Bearer <token>`
- 响应体：

```json
{
  "feedId": "string",
  "title": "string",
  "url": "https://example.com/feed.xml",
  "siteUrl": "https://example.com",
  "lastFetched": "2024-03-01T08:00:00Z",
  "lastUpdated": "2024-03-01T09:45:00Z",
  "latestPublishedAt": "2024-03-01T10:00:00Z",
  "articleCount": 128,
  "subscriberCount": 56,
  "subscribed": true
}
```

- `latestPublishedAt`：最近一篇文章的发布时间，若暂无文章时退回 `lastUpdated`。
- `subscribed`：当前用户是否已订阅该源。

### 通过 Feed URL 查询详情

- 方法：`GET /api/feeds/lookup`
- 认证：`Bearer <token>`
- 查询参数：
    - `feedUrl`（必填）：订阅源的 RSS 地址。
- 响应体：同 “获取订阅源详情”。

## 4. 用户行为

### 收藏文章

- 方法：`POST /api/user/collections/:articleId`
- 认证：`Bearer <token>`
- 响应体：

```json
{
  "message": "Article collected."
}
```

### 取消收藏

- 方法：`DELETE /api/user/collections/:articleId`
- 认证：`Bearer <token>`
- 响应体：

```json
{
  "message": "Article uncollected."
}
```

### 获取收藏列表

- 方法：`GET /api/user/collections`
- 认证：`Bearer <token>`
- 查询参数：
    - `page`（默认 0）
    - `size`（默认 10）
    - `sort`（可选，如 `collectedAt,desc`）
- 响应体：

```json
{
  "content": [
    {
      "articleId": "string",
      "title": "string",
      "collectedAt": "2024-03-01T09:30:00Z"
    }
  ],
  "pageable": {
    "pageNumber": 0,
    "pageSize": 10,
    "sort": {
      "sorted": true,
      "unsorted": false,
      "empty": false
    }
  },
  "totalElements": 12,
  "totalPages": 2,
  "last": false,
  "first": true,
  "size": 10,
  "number": 0,
  "sort": {
    "sorted": true,
    "unsorted": false,
    "empty": false
  },
  "numberOfElements": 10,
  "empty": false
}
```

### 记录阅读历史

- 方法：`POST /api/user/history`
- 认证：`Bearer <token>`
- 请求体：

```json
{
  "articleId": "string",
  "readAt": "2024-03-01T10:20:00Z"
}
```

- 说明：`readAt` 可选，未提供时由服务器记录当前时间。
- 响应体：

```json
{
  "message": "History recorded."
}
```

### 获取阅读历史列表

- 方法：`GET /api/user/history`
- 认证：`Bearer <token>`
- 查询参数：
    - `page`（默认 0）
    - `size`（默认 10）
    - `sort`（默认 `readAt,desc`）
- 响应体：

```json
{
  "content": [
    {
      "articleId": "string",
      "title": "string",
      "readAt": "2024-03-01T10:20:00Z"
    }
  ],
  "pageable": {
    "pageNumber": 0,
    "pageSize": 10,
    "sort": {
      "sorted": true,
      "unsorted": false,
      "empty": false
    }
  },
  "totalElements": 58,
  "totalPages": 6,
  "last": false,
  "first": true,
  "size": 10,
  "number": 0,
  "sort": {
    "sorted": true,
    "unsorted": false,
    "empty": false
  },
  "numberOfElements": 10,
  "empty": false
}
```

### 记录feed已读

- 方法：`POST /api/user/readfeed/:feedId`
- 认证：`Bearer <token>`
- 响应体：

```json
{
  "message": "Feed read."
}
```

## 5. 搜索

### 搜索文章

- 方法：`GET /api/search`
- 认证：`Bearer <token>`
- 查询参数：
    - `query`（关键词或自然语言，必填）
    - `type`（`keyword` 或 `semantic`，可选，默认 `keyword`）
    - `source`（可选，默认 `owner`。`owner`：只返回当前用户的数据；`global`：返回全局数据，不区分用户）
    - `page`（默认 0）
    - `size`（默认 10）
- 响应体：

```json
{
  "content": [
    {
      "id": "string",
      "title": "string",
      "summary": "string",
      "score": 0.87
    }
  ],
  "pageable": {
    "pageNumber": 0,
    "pageSize": 10,
    "sort": {
      "sorted": false,
      "unsorted": true,
      "empty": true
    }
  },
  "totalElements": 23,
  "totalPages": 3,
  "last": false,
  "first": true,
  "size": 10,
  "number": 0,
  "sort": {
    "sorted": false,
    "unsorted": true,
    "empty": true
  },
  "numberOfElements": 10,
  "empty": false
}
```
