# 🧩 环境变量参数说明文档

以下为应用配置中引用的所有大写环境变量及其默认值。

| 环境变量名 | 默认值 | 说明 |
|-------------|----------|------|
| **`PG`** | `127.0.0.1` | PostgreSQL 主机地址 |
| **`PG_PORT`** | `5432` | PostgreSQL 端口号 |
| **`PG_DATABASE`** | `i_feed` | PostgreSQL 数据库名 |
| **`PG_USERNAME`** | `i_feed` | PostgreSQL 用户名 |
| **`PG_PASSWORD`** | `0123.` | PostgreSQL 密码 |
| **`VECTOR_INDEX_TYPE`** | `HNSW` | 向量索引类型（如 HNSW / IVF_FLAT / L2 等） |
| **`VECTOR_DISTANCE_TYPE`** | `COSINE_DISTANCE` | 向量距离度量方式（如 COSINE_DISTANCE / L2_DISTANCE） |
| **`MONGO_DB`** | `127.0.0.1` | MongoDB 主机地址 |
| **`MONGO_DB_PORT`** | `27017` | MongoDB 端口号 |
| **`MONGO_DB_USERNAME`** | `mongo_cTXZaN` | MongoDB 用户名 |
| **`MONGO_DB_PASSWORD`** | `mongo_MDNyW6` | MongoDB 密码 |
| **`MONGO_DB_DATABASE`** | `i_feed` | MongoDB 数据库名 |


# 🧭 应用配置参数说明文档

```yaml
app:
  # 定时任务
  rss:
    fetcher:
      fixed-delay: PT60M
      initial-delay: PT1M
      thread-pool-size: 10
      connect-timeout: 50s
      read-timeout: 100s
      max-items: 500
      max-retries: 3
      cache:
        expire-after-write: 30m
        maximum-size: 1000
  embedding:
    document:
      fixed-delay: PT10M
      initial-delay: PT15M
    user:
      fixed-delay: PT12H
      initial-delay: PT30s
      options:
        recent-behavior-limit: 200
        default-profile: '科技, 人工智能, 金融科技, 产品设计, 财经, 商业, 社会, 文化, 人物故事, 政治, 国际关系, 娱乐, 生活方式, 音乐, 游戏, 体育, 健康, 教育, 播客, 新闻, 科学, 犯罪悬疑, 环境保护, 历史, 心理学, 文学, 艺术, 创业, 政策, 国际贸易, 网络安全, 航天科技, 健康医疗, 社会经济, 文化评论, 综合'
  # ai 集成
  ai:
    provider:
      enabled: false
      endpoint: ''
      api-key: ''
      model: 'gpt-4o-mini'
      embedding:
        endpoint: '${app.ai.provider.endpoint}'
        api-key: '${app.ai.provider.api-key}'
        model: 'Qwen/Qwen3-Embedding-4B'
        options:
          dimensions: 1024
  # 检索
  search:
    retrieval:
      bm25-top-k: 120
      vector-top-k: 120
      fusion-top-k: 200
      bm25-weight: 0.6
      vector-weight: 0.4
      freshness-time-weight: 0.3
      freshness-lambda: 0.01
      similarity-threshold: 0.3
```




## 一、RSS 定时任务（`app.rss`）

用于控制系统自动抓取 RSS 订阅源的行为。

### `app.rss.fetcher`

| 参数 | 类型 | 示例值 | 说明 |
|------|------|--------|------|
| `fixed-delay` | `Duration` | `PT60M` | 抓取任务的固定延迟周期（ISO-8601 时长格式），即每次任务间隔多久执行。此处为 **每 60 分钟** 执行一次。 |
| `initial-delay` | `Duration` | `PT1M` | 启动应用后等待的初始延迟时间，之后再启动任务。此处为 **延迟 1 分钟** 开始执行第一次抓取。 |
| `thread-pool-size` | `int` | `10` | RSS 抓取线程池大小，控制同时抓取的源数量。 |
| `connect-timeout` | `Duration` | `50s` | HTTP 连接超时时间（秒）。 |
| `read-timeout` | `Duration` | `100s` | 读取响应超时时间（秒）。 |
| `max-items` | `int` | `500` | 每次抓取时最多处理的条目数量，用于防止单源过大造成内存压力。 |
| `max-retries` | `int` | `3` | 抓取失败时的最大重试次数。 |
| `cache.expire-after-write` | `Duration` | `30m` | RSS 抓取结果缓存的有效期（写入后 30 分钟过期）。 |
| `cache.maximum-size` | `int` | `1000` | 缓存中最多保存的 RSS 源数量。 |

---

## 二、Embedding 定时任务（`app.embedding`）

控制内容与用户画像的嵌入生成与更新频率。

### `app.embedding.document`

| 参数 | 类型 | 示例值 | 说明 |
|------|------|--------|------|
| `fixed-delay` | `Duration` | `PT10M` | 文档内容嵌入任务执行间隔（每 10 分钟执行一次）。 |
| `initial-delay` | `Duration` | `PT15M` | 应用启动后延迟多久开始执行文档嵌入任务（15 分钟）。 |

### `app.embedding.user`

| 参数 | 类型 | 示例值 | 说明 |
|------|------|--------|------|
| `fixed-delay` | `Duration` | `PT12H` | 用户画像嵌入任务执行间隔（每 12 小时执行一次）。 |
| `initial-delay` | `Duration` | `PT30s` | 应用启动后延迟多久开始执行（30 秒）。 |

#### `app.embedding.user.options`

| 参数 | 类型 | 示例值 | 说明 |
|------|------|--------|------|
| `recent-behavior-limit` | `int` | `200` | 用户行为记录的最大采样条数，用于生成个性化嵌入。 |
| `default-profile` | `string` | `'科技, 人工智能, ...'` | 默认用户兴趣画像关键词，用于无历史用户或冷启动时初始化用户向量。 |

---

## 三、AI 模型集成（`app.ai`）

### `app.ai.provider`

| 参数 | 类型 | 示例值 | 说明 |
|------|------|--------|------|
| `enabled` | `boolean` | `false` | 是否启用 AI 模型服务集成。 |
| `endpoint` | `string` | `''` | AI 模型 API 地址。 |
| `api-key` | `string` | `''` | AI 服务 API 密钥。 |
| `model` | `string` | `'gpt-4o-mini'` | 默认对话模型名称。 |

#### `app.ai.provider.embedding`

| 参数 | 类型 | 示例值 | 说明 |
|------|------|--------|------|
| `endpoint` | `string` | `'${app.ai.provider.endpoint}'` | 嵌入模型服务地址，默认继承主 AI endpoint。 |
| `api-key` | `string` | `'${app.ai.provider.api-key}'` | 嵌入模型的 API 密钥。 |
| `model` | `string` | `'Qwen/Qwen3-Embedding-4B'` | 嵌入生成模型名称。 |
| `options.dimensions` | `int` | `1024` | 向量维度大小（embedding 输出维度）。 |

---

## 四、检索配置（`app.search.retrieval`）

用于混合检索（BM25 + 向量召回）的融合策略。

| 参数 | 类型 | 示例值 | 说明 |
|------|------|--------|------|
| `bm25-top-k` | `int` | `120` | 传统文本检索（BM25）返回的候选数量。 |
| `vector-top-k` | `int` | `120` | 向量检索返回的候选数量。 |
| `fusion-top-k` | `int` | `200` | 最终融合排序后保留的候选数量。 |
| `bm25-weight` | `float` | `0.6` | 融合时 BM25 分数的权重。 |
| `vector-weight` | `float` | `0.4` | 融合时向量相似度分数的权重。 |
| `freshness-time-weight` | `float` | `0.3` | 融合时新鲜度（时间衰减）的权重。 |
| `freshness-lambda` | `float` | `0.01` | 时间衰减速率参数，值越大越强调最新内容。 |
| `similarity-threshold` | `float` | `0.3` | 最小相似度阈值，低于此值的结果将被过滤。 |

---

## 📘 附录：时间格式说明（ISO-8601 Duration）

配置中 `PT` 开头的时长为 **ISO-8601 时间格式**：

| 表示形式 | 含义 | 示例 |
|-----------|--------|------|
| `PT30S` | 30 秒 | S = 秒 |
| `PT5M` | 5 分钟 | M = 分钟 |
| `PT2H` | 2 小时 | H = 小时 |
| `P1D` | 1 天 | D = 天 |